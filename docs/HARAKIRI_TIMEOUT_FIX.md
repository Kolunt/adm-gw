# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã HARAKIRI (—Ç–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤)

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–í Server log –≤–∏–¥–Ω–æ:
```
HARAKIRI ON WORKER 1
HARAKIRI triggered by worker 1
DAMN ! worker 1 (pid: 8) died, killed by signal 9
```

**HARAKIRI** - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º uWSGI, –∫–æ—Ç–æ—Ä—ã–π —É–±–∏–≤–∞–µ—Ç worker –ø—Ä–æ—Ü–µ—Å—Å—ã, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ–ª—å—à–µ 30 —Å–µ–∫—É–Ω–¥.

## ‚úÖ –ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–∏—á–∏–Ω–∞ 1: Startup event –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–°–∏–º–ø—Ç–æ–º:** –ó–∞–ø—Ä–æ—Å –≤–∏—Å–∏—Ç –∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

**–ü—Ä–æ–±–ª–µ–º–∞:** Startup events –≤ FastAPI –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ startup events –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ `backend/main.py`:
- `@app.on_event("startup")` –Ω–µ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î - –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ–π –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ß—Ç–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

**–°–∏–º–ø—Ç–æ–º:** –ó–∞–ø—Ä–æ—Å –∫ `/` –≤–∏—Å–∏—Ç.

**–ü—Ä–æ–±–ª–µ–º–∞:** `FileResponse` –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop.

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω WSGI –∞–¥–∞–ø—Ç–µ—Ä —Å —Ç–∞–π–º–∞—É—Ç–æ–º 25 —Å–µ–∫—É–Ω–¥ –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

### –ü—Ä–∏—á–∏–Ω–∞ 3: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ –∫–æ–¥–µ

**–°–∏–º–ø—Ç–æ–º:** –ó–∞–ø—Ä–æ—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Error log
2. –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –≤ startup events

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ startup events

–í `backend/main.py` –Ω–∞–π–¥–∏—Ç–µ `@app.on_event("startup")` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

–ï—Å–ª–∏ —Ç–∞–º –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –ë–î, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö), –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º–∏ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è WSGI —Ñ–∞–π–ª–∞ –≤ Server log –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
WSGI REQUEST: GET /
WSGI RESPONSE: 200 15 headers
WSGI RESPONSE BODY: 12345 bytes
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `WSGI TIMEOUT` - –∑–Ω–∞—á–∏—Ç –∑–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏—Å–∏—Ç.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä index.html

```bash
cd ~/gwadm
ls -lh build/index.html
```

–ï—Å–ª–∏ —Ñ–∞–π–ª –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π (>5MB), —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–í startup event –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ë–æ–ª—å—à–∏—Ö —Ü–∏–∫–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –û–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –±–µ–∑ async

## ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–ª—é—á–∏—Ç—å startup events –≤—Ä–µ–º–µ–Ω–Ω–æ

–ï—Å–ª–∏ startup events –≤—ã–∑—ã–≤–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Ö –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:

```python
# @app.on_event("startup")
# async def startup_event():
#     ...
```

–ò –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î –≤—Ä—É—á–Ω—É—é:

```bash
cd ~/gwadm/backend
python3.10 -c "from main import Base, engine; Base.metadata.create_all(bind=engine)"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–≤–µ–ª–∏—á–∏—Ç—å HARAKIRI timeout (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í PythonAnywhere –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Web –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–∞—É—Ç, –Ω–æ —ç—Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - –ª—É—á—à–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å startup events

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ startup events –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (<1 —Å–µ–∫—É–Ω–¥—ã).

## üìù –ß—Ç–æ —è –∏—Å–ø—Ä–∞–≤–∏–ª

1. –î–æ–±–∞–≤–∏–ª —Ç–∞–π–º–∞—É—Ç 25 —Å–µ–∫—É–Ω–¥ –≤ WSGI –∞–¥–∞–ø—Ç–µ—Ä
2. –£–ª—É—á—à–∏–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. –î–æ–±–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç ASGI

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Error log - –º–æ–≥—É—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–∏–¥–Ω—ã –≤ Server log
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å startup events
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ —á—Ç–æ-—Ç–æ event loop

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ Error log - —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

